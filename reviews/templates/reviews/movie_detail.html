{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block title %}{{ movie.title }}{% endblock %}

{% block content %}
<h2>{{ movie.title }}</h2>
<p>{{ movie.description }}</p>

<h3>Reviews:</h3>
<p>Average Rating: {{ average_rating|floatformat:1 }}/5</p>

{% for review in reviews %}
  <div class="card my-3">
    <div class="card-body">
      <strong>{{ review.user.username }}</strong> -
      {{ review.rating }}/5
      <p class="mt-2">{{ review.content }}</p>
      <small class="text-muted">{{ review.created_on }}</small>
    </div>
  </div>
{% empty %}
  <p>No reviews yet. Be the first to leave one!</p>
{% endfor %}
{% if user.is_authenticated %}
    <h3>Leave a Review</h3>
    <form method="post">
        {% csrf_token %}
        {{ form|crispy }}
        <button type="submit" class="btn btn-primary">Submit Review</button>
    </form>
{% else %}
    <p><a href="{% url 'login' %}">Log in</a> to leave a review.</p>
{% endif %}
{% endblock %}
